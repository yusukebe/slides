<!doctype html><html lang=en><head><meta charset=utf-8><title>Dive into Cloudflare Workers</title><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel=canonical href=https://yusukebe.github.io/slides/pwanight-conf-2022/><meta property="og:title" content="Dive into Cloudflare Workers &ndash; yusukebe/slides"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://yusukebe.github.io/slides/pwanight-conf-2022/"><meta property="og:site_name" content="yusukebe/slides"><meta name=twitter:card content="summary_large_image"><meta name=twitter:domain content="yusukebe.github.com"><meta name=twitter:title content="Dive into Cloudflare Workers &ndash; yusukebe/slides"><meta name=twitter:description content><link rel=stylesheet href=/slides/reveal-js/css/reset.css><link rel=stylesheet href=/slides/reveal-js/css/reveal.css><link rel=stylesheet href=/slides/_.min.987502fe84ada46c1007ceba381f024831c3f8a91da4d3557a6728583666d6aa.css id=theme><link rel=stylesheet href=/slides/highlight-js/default.min.css></head><body><div class=reveal><div class=slides><section><h1 id=dive-into-cloudflare-workers>Dive into Cloudflare Workers</h1><p>2022-12-03 PWA Night Conference 2022</p><p>Yusuke Wada</p></section><section><h2 id=me>Me:)</h2><ul><li>Yusuke Wada</li><li>Supervisor at TravelBook Inc. <a href=https://www.travelbook.co.jp>https://www.travelbook.co.jp</a></li><li>Web framework developer</li><li><a href=https://yusukebe.com>https://yusukebe.com</a></li><li><a href=https://github.com/yusukebe>https://github.com/yusukebe</a></li></ul></section><section><p>Today&rsquo;s topics</p><h2 id=cloudflare-workers>Cloudflare Workers</h2><p>with D1 and Hono</p></section><section><h3 id=cloudflare-workers-1>Cloudflare Workers</h3><ul><li>Works on the Edge</li><li>&ldquo;Glue&rdquo; for Supercloud</li><li>Small and Fast</li><li>Easy to deploy</li><li>Write in JavaScript</li></ul></section><section><h3 id=cloudflare-d1>Cloudflare D1</h3><ul><li>Serverless SQL database</li><li>SQLite is used inside</li><li>Integrated with Workers</li><li>Open alpha</li></ul></section><section><h3 id=hono>Hono</h3><ul><li>Created by me:)</li><li><a href=https://honojs.dev>https://honojs.dev</a></li><li><a href=https://github.com/honojs/hono>https://github.com/honojs/hono</a></li><li>Fast web framework</li><li>Works on Cloudflare Workers, Deno, Bun, and Node.js</li><li>Using Web Standard API</li><li>Express.js like syntax</li></ul></section><section><h2 id=live-coding>Live-coding</h2><p>Making a Blog site</p><ul><li>Cloudflare Workers</li><li>Cloudflare D1</li><li>Hono</li></ul></section><section><p><a href=https://github.com/yusukebe/hello-d1>https://github.com/yusukebe/hello-d1</a></p></section><section><h2 id=1-your-first-worker>1. Your first Worker</h2></section><section><h3 id=setup-project>Setup project</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>yarn init -y
</span></span><span style=display:flex><span>yarn add -D wrangler
</span></span><span style=display:flex><span>yarn wrangler init -y
</span></span></code></pre></div></section><section><h3 id=install-hono>Install Hono</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>yarn add hono
</span></span></code></pre></div></section><section><h3 id=packagejson><code>package.json</code></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#e6db74>&#34;scripts&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;dev&#34;</span>: <span style=color:#e6db74>&#34;wrangler dev src/index.tsx&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;deploy&#34;</span>: <span style=color:#e6db74>&#34;wrangler publish src/index.tsx&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;test&#34;</span>: <span style=color:#e6db74>&#34;jest&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=tsconfigjson><code>tsconfig.json</code></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;compilerOptions&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;lib&#34;</span>: [
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;ESNext&#34;</span>
</span></span><span style=display:flex><span>    ],
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;types&#34;</span>: [
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;jest&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;@cloudflare/workers-types&#34;</span>
</span></span><span style=display:flex><span>    ],
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;jsx&#34;</span>: <span style=color:#e6db74>&#34;react&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;jsxFactory&#34;</span>: <span style=color:#e6db74>&#34;jsx&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;jsxFragmentFactory&#34;</span>: <span style=color:#e6db74>&#34;Fragment&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;include&#34;</span>: [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;src/**/*&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;tests/**/*&#34;</span>
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=write-code>Write code</h3><p><code>src/index.tsx</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Hono</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;hono&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>app</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Hono</span>()
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#66d9ef>get</span>(<span style=color:#e6db74>&#39;/hello&#39;</span>, (<span style=color:#a6e22e>c</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>text</span>(<span style=color:#e6db74>&#39;Hello PWA night!&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>app</span>
</span></span></code></pre></div></section><section><h3 id=run>Run</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>yarn dev
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>open http://localhost:8787
</span></span></code></pre></div></section><section><h3 id=deploy>Deploy</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>yarn deploy
</span></span></code></pre></div></section><section><p>üëç</p></section><section><h2 id=2-using-hono>2. Using Hono</h2></section><section><p><a href=https://honojs.dev/>https://honojs.dev/</a></p></section><section><p>üëç</p></section><section><h2 id=3-blog-part-1>3. Blog Part 1</h2></section><section><p>Model</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Post</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>title</span>: <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>body</span>: <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>posts</span>: <span style=color:#66d9ef>Post</span>[] <span style=color:#f92672>=</span> []
</span></span></code></pre></div></section><section><p>Logic</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>createPost</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>post</span>: <span style=color:#66d9ef>Post</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>post</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>getPosts</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>posts</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><p>Validator Middleware</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>validator</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;hono/validator&#39;</span>
</span></span></code></pre></div></section><section><p><code>app.post('/post')</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>post</span>(
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;/post&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>validator</span>((<span style=color:#a6e22e>v</span>) <span style=color:#f92672>=&gt;</span> ({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>title</span>: <span style=color:#66d9ef>v.body</span>(<span style=color:#e6db74>&#39;title&#39;</span>).<span style=color:#a6e22e>isRequired</span>(),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>body</span>: <span style=color:#66d9ef>v.body</span>(<span style=color:#e6db74>&#39;body&#39;</span>).<span style=color:#a6e22e>isRequired</span>(),
</span></span><span style=display:flex><span>  })),
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>c</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>title</span>, <span style=color:#a6e22e>body</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>valid</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>createPost</span>({ <span style=color:#a6e22e>title</span>, <span style=color:#a6e22e>body</span> })
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>redirect</span>(<span style=color:#e6db74>&#39;/&#39;</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>)
</span></span></code></pre></div></section><section><p>TSX</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>touch src/Layout.tsx
</span></span><span style=display:flex><span>touch src/Top.tsx
</span></span></code></pre></div></section><section><p><code>Layout.tsx</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>html</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;hono/html&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Layout</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>props</span>: <span style=color:#66d9ef>any</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>html</span><span style=color:#e6db74>`&lt;!DOCTYPE html&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &lt;html&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;head&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;title&gt;Hello D1!&lt;/title&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;link rel=&#34;stylesheet&#34; href=&#34;https://unpkg.com/@picocss/pico@latest/css/pico.min.css&#34; /&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;/head&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;body&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;body&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;main class=&#34;container&#34;&gt;</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>children</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&lt;/main&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;/body&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;/body&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &lt;/html&gt;`</span>
</span></span></code></pre></div></section><section><p><code>Top.tsx</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>jsx</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;hono/jsx&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Layout</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;./Layout&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#66d9ef>type</span> { <span style=color:#a6e22e>Post</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;./index&#39;</span>
</span></span></code></pre></div></section><section><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Form</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>form</span> <span style=color:#a6e22e>action</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;/post&#39;</span> <span style=color:#a6e22e>method</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;POST&#39;</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>label</span>&gt;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Title</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;title&#39;</span> /&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>label</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>label</span>&gt;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Body</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>textarea</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;body&#39;</span> <span style=color:#a6e22e>rows</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;5&#39;</span> <span style=color:#a6e22e>cols</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;33&#39;</span>&gt;&lt;/<span style=color:#f92672>textarea</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>label</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;submit&#39;</span> /&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>form</span>&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>Top</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>props</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>posts</span>: <span style=color:#66d9ef>Post</span>[] }) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>Layout</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>h1</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>a</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;/&#39;</span>&gt;<span style=color:#a6e22e>Hello</span> <span style=color:#a6e22e>D1</span><span style=color:#f92672>!</span>&lt;/<span style=color:#f92672>a</span>&gt;
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>h1</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>Form</span> /&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>hr</span> /&gt;
</span></span><span style=display:flex><span>      {<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>posts</span>.<span style=color:#a6e22e>reverse</span>().<span style=color:#a6e22e>map</span>((<span style=color:#a6e22e>post</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>article</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>h2</span>&gt;{<span style=color:#a6e22e>post</span>.<span style=color:#a6e22e>title</span>}&lt;/<span style=color:#f92672>h2</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>p</span>&gt;{<span style=color:#a6e22e>post</span>.<span style=color:#a6e22e>body</span>}&lt;/<span style=color:#f92672>p</span>&gt;
</span></span><span style=display:flex><span>          &lt;/<span style=color:#f92672>article</span>&gt;
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>      })}
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>Layout</span>&gt;
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><p><code>app.get('/')</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>jsx</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;hono/jsx&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Top</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;./Top&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#66d9ef>get</span>(<span style=color:#e6db74>&#39;/&#39;</span>, (<span style=color:#a6e22e>c</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>posts</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getPosts</span>()
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>html</span>(&lt;<span style=color:#f92672>Top</span> <span style=color:#a6e22e>posts</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>posts</span>} /&gt;)
</span></span><span style=display:flex><span>})
</span></span></code></pre></div></section><section><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>yarn dev
</span></span><span style=display:flex><span>yarn deploy
</span></span></code></pre></div></section><section><p>üëç</p></section><section><h2 id=4-using-d1>4. Using D1</h2></section><section><p><code>blog.sql</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> post (
</span></span><span style=display:flex><span>  id INTEGER <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>,
</span></span><span style=display:flex><span>  title TEXT <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>,
</span></span><span style=display:flex><span>  body TEXT <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>
</span></span><span style=display:flex><span>);
</span></span></code></pre></div></section><section><p>Create Database</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>wrangler d1 create pwa-night
</span></span></code></pre></div></section><section><p><code>wrangler.toml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>[[ <span style=color:#a6e22e>d1_databases</span> ]]
</span></span><span style=display:flex><span><span style=color:#a6e22e>binding</span> = <span style=color:#e6db74>&#34;DB&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>database_name</span> = <span style=color:#e6db74>&#34;pwa-night&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>database_id</span> = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>preview_database_id</span> = <span style=color:#e6db74>&#34;&#34;</span>
</span></span></code></pre></div></section><section><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>wrangler d1 execute pwa-night --file blog.sql
</span></span><span style=display:flex><span>wrangler d1 execute pwa-night --command &#34;SELECT name FROM sqlite_schema WHERE type =&#39;table&#39;&#34;
</span></span></code></pre></div></section><section><p>üëç</p></section><section><h2 id=5-blog-part-2>5. Blog Part 2</h2></section><section><p>Bindings</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Env</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>DB</span>: <span style=color:#66d9ef>D1Database</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>app</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Hono</span><span style=color:#f92672>&lt;</span>{ <span style=color:#a6e22e>Bindings</span>: <span style=color:#66d9ef>Env</span> }<span style=color:#f92672>&gt;</span>()
</span></span></code></pre></div></section><section><p><code>app.get('/')</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>results</span> } <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>DB</span>.<span style=color:#a6e22e>prepare</span>(
</span></span><span style=display:flex><span>  <span style=color:#e6db74>`SELECT id,title,body FROM post;`</span>
</span></span><span style=display:flex><span>).<span style=color:#a6e22e>all</span>&lt;<span style=color:#f92672>Post</span>&gt;()
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>posts</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>results</span>
</span></span></code></pre></div></section><section><p><code>app.post('/post')</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>await</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>DB</span>.<span style=color:#a6e22e>prepare</span>(<span style=color:#e6db74>`INSERT INTO post(title, body) VALUES(?, ?);`</span>)
</span></span><span style=display:flex><span>  .<span style=color:#a6e22e>bind</span>(<span style=color:#a6e22e>title</span>, <span style=color:#a6e22e>body</span>)
</span></span><span style=display:flex><span>  .<span style=color:#a6e22e>run</span>()
</span></span></code></pre></div></section><section><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>yarn dev
</span></span><span style=display:flex><span>yarn deploy
</span></span></code></pre></div></section><section><p>üëç</p></section><section><h2 id=6-tests>6. Tests</h2></section><section><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>yarn add -D jest jest-environment-miniflare @types/jest esbuild-jest
</span></span></code></pre></div></section><section><p><code>jest.config.js</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#a6e22e>module</span>.<span style=color:#a6e22e>exports</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>testEnvironment</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;miniflare&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>testMatch</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#39;**/tests/**/*.+(ts|tsx)&#39;</span>],
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>transform</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;^.+\\.(ts|tsx)$&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;esbuild-jest&#39;</span>,
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><p><code>tests/index.ts</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>app</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#39;../src/index&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>describe</span>(<span style=color:#e6db74>&#39;Test endpoints&#39;</span>, () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>it</span>(<span style=color:#e6db74>&#39;Should return 200 Response&#39;</span>, <span style=color:#66d9ef>async</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>res</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>request</span>(<span style=color:#e6db74>&#39;http://localhost/hello&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>expect</span>(<span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>status</span>).<span style=color:#a6e22e>toBe</span>(<span style=color:#ae81ff>200</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>expect</span>(<span style=color:#66d9ef>await</span> <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>text</span>()).<span style=color:#a6e22e>toBe</span>(<span style=color:#e6db74>&#39;Hello!&#39;</span>)
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>})
</span></span></code></pre></div></section><section><h2 id=7-wrap-up>7. Wrap up</h2><ul><li>Your First Worker</li><li>Using Hono</li><li>Blog Part1</li><li>Using D1</li><li>Blog Part2</li><li>Tests</li></ul></section><section><h2 id=try-cloudflare-workers>Try Cloudflare Workers</h2></section></div></div><script type=text/javascript src=/slides/reveal-hugo/object-assign.js></script>
<a href=/slides/reveal-js/css/print/ id=print-location style=display:none></a>
<script type=text/javascript>var printLocationElement=document.getElementById("print-location"),link=document.createElement("link");link.rel="stylesheet",link.type="text/css",link.href=printLocationElement.href+(window.location.search.match(/print-pdf/gi)?"pdf.css":"paper.css"),document.getElementsByTagName("head")[0].appendChild(link)</script><script type=application/json id=reveal-hugo-site-params>{"custom_theme":"stylesheets/custom-theme.scss","custom_theme_compile":true}</script><script type=application/json id=reveal-hugo-page-params>null</script><script src=/slides/reveal-js/js/reveal.js></script>
<script type=text/javascript>function camelize(e){return e&&Object.keys(e).forEach(function(t){newK=t.replace(/(_\w)/g,function(e){return e[1].toUpperCase()}),newK!=t&&(e[newK]=e[t],delete e[t])}),e}var revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams=JSON.parse(document.getElementById("reveal-hugo-site-params").innerHTML),revealHugoPageParams=JSON.parse(document.getElementById("reveal-hugo-page-params").innerHTML),options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams));Reveal.initialize(options)</script><script type=text/javascript src=/slides/reveal-js/plugin/markdown/marked.js></script>
<script type=text/javascript src=/slides/reveal-js/plugin/markdown/markdown.js></script>
<script type=text/javascript src=/slides/reveal-js/plugin/highlight/highlight.js></script>
<script type=text/javascript src=/slides/reveal-js/plugin/zoom-js/zoom.js></script>
<script type=text/javascript src=/slides/reveal-js/plugin/notes/notes.js></script></body></html>