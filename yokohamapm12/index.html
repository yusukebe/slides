<!doctype html><html lang=en><head><meta charset=utf-8><title>横浜に住んで。横浜から離れて(仮)</title><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel=canonical href=https://yusukebe.github.io/slides/yokohamapm12/><meta property="og:title" content="横浜に住んで。横浜から離れて(仮) &ndash; yusukebe/slides"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://yusukebe.github.io/slides/yokohamapm12/"><meta property="og:site_name" content="yusukebe/slides"><meta name=twitter:card content="summary_large_image"><meta name=twitter:domain content="yusukebe.github.com"><meta name=twitter:title content="横浜に住んで。横浜から離れて(仮) &ndash; yusukebe/slides"><meta name=twitter:description content><link rel=stylesheet href=/slides/reveal-js/css/reset.css><link rel=stylesheet href=/slides/reveal-js/css/reveal.css><link rel=stylesheet href=/slides/_.min.987502fe84ada46c1007ceba381f024831c3f8a91da4d3557a6728583666d6aa.css id=theme><link rel=stylesheet href=/slides/highlight-js/default.min.css></head><body><div class=reveal><div class=slides><section><h1 id=横浜に住んでbr-横浜から離れて仮>横浜に住んで。<br>横浜から離れて(仮)</h1><p>Yusuke Wada a.k.a. yusukebe</p><p>2014/11/28</p><p>Yokohama.pm#12</p></section><section><h2 id=横浜といえば>横浜といえば&mldr;</h2></section><section><p><img src=images/tweet.png alt=Tweet></p></section><section><h2 id=ジャンクフードと-kazeburo-さん>ジャンクフードと kazeburo さん</h2></section><section><h2 id=gazelle>Gazelle</h2><p><img src=images/blog.png alt=Gazelle></p></section><section><h2 id=ガゼル>ガゼル！</h2></section><section><p>ということで kazeburo さんが速いサーバを書いたので</p><p><strong>本番で</strong>使ってみる！</p></section><section><p>試験環境じゃつまらないので稼働中の API サーバに入れてみる</p><pre tabindex=0><code>$ cpanm Gazelle
</code></pre><pre tabindex=0><code>$ lv /XXX/daemontools/bokete_api/run
</code></pre><pre tabindex=0><code>carton exec start_server --path=/dev/shm/app.sock \
-- plackup -s Gazelle \
--max-workers 50 --max-reqs-per-child 10000 \
-E production-api -a ./psgi/bokete_web_api.psgi
</code></pre></section><section><p>とりあえず稼働中ですが&mldr;</p><p>参考にしにくいですが&mldr;</p><p>ab 打ってみた</p><pre tabindex=0><code>$ ab -n 10000 -c 50 http://10.0.x.x/xxx/xxx
</code></pre></section><section><p>以下と結果を比較(他の環境は同じことを確認)</p><ul><li>A. Starlet &lt;=> port &lt;=> Nginx</li><li>B. Gazelle &lt;=> unix domain socket &lt;=> Nginx</li></ul></section><section><h2 id=結果>結果</h2><ol><li>ロジック無し</li><li>ロジック有り</li></ol></section><section><h2 id=1-ロジック無し>1. ロジック無し</h2><h3 id=gazelle--177-faster>Gazelle => 177% faster!!</h3></section><section><h2 id=2-ロジック有り>2. ロジック有り</h2><h3 id=gazelle--110-faster>Gazelle => 110% faster!!</h3></section><section><h2 id=速い>速い！</h2><p>って&mldr; もしてかして&mldr;</p></section><section><h2 id=unix-domain-socket-だから>unix domain socket だから？</h2></section><section><h2 id=以下で比較してみた>以下で比較してみた</h2><ul><li>B. Gazelle &lt;=> unix domain socket &lt;=> Nginx</li><li>C. Starlet &lt;=> unix domain socket &lt;=> Nginx</li></ul></section><section><h2 id=結果-1>結果</h2></section><section><h3 id=1-ロジック無し-1>1. ロジック無し</h3><ul><li><strong>Starlet</strong> => 103% faster</li></ul><br><h3 id=2-ロジック有り-1>2. ロジック有り</h3><ul><li><strong>Gazelle</strong> => 102% faster</li></ul></section><section><blockquote><p>あれ？</p></blockquote></section><section><h2 id=悔しいのでユーザーからのアクセスが無い環境をつくって試した>悔しいのでユーザーからのアクセスが無い環境をつくって試した</h2></section><section><h3 id=a-starlet--port>A. Starlet / port</h3><ol><li>=> 504.57 req/sec</li><li>=> 92.11 req/sec</li></ol><br><h3 id=b-gazelle--unix-domain-socket>B. Gazelle / unix domain socket</h3><ol><li>=> 625.65 req/sec</li><li>=> 95.51 req/sec</li></ol><br><h3 id=c-starlet--unix-domain-socket>C. Starlet / unix domain socket</h3><ol><li>=> 641.32 req/sec</li><li>=> 92.30 req/sec</li></ol></section><section><blockquote><p>なるほど！</p></blockquote></section><section><h2 id=結論>結論</h2><ul><li>Nginx へは port 接続より**unix domain socket を使うと速い!! ** (Starlet/Gazelle)</li><li>ただ本アプリでは Starlet と Gazelle の差があまり見られなかった</li><li>「そもそも高速な App サーバ要らない」って誰かが言ってた！</li><li>kazeburo さんありがとうございます(何かあればお伝えします)</li></ul></section><section><h2 id=宣伝>宣伝</h2><p>ハチイチ忘年会 12 月 13 日だよ！</p><p><img src=images/81.png alt=ハチイチ></p></section></div></div><script type=text/javascript src=/slides/reveal-hugo/object-assign.js></script>
<a href=/slides/reveal-js/css/print/ id=print-location style=display:none></a>
<script type=text/javascript>var printLocationElement=document.getElementById("print-location"),link=document.createElement("link");link.rel="stylesheet",link.type="text/css",link.href=printLocationElement.href+(window.location.search.match(/print-pdf/gi)?"pdf.css":"paper.css"),document.getElementsByTagName("head")[0].appendChild(link)</script><script type=application/json id=reveal-hugo-site-params>{"custom_theme":"stylesheets/custom-theme.scss","custom_theme_compile":true}</script><script type=application/json id=reveal-hugo-page-params>null</script><script src=/slides/reveal-js/js/reveal.js></script>
<script type=text/javascript>function camelize(e){return e&&Object.keys(e).forEach(function(t){newK=t.replace(/(_\w)/g,function(e){return e[1].toUpperCase()}),newK!=t&&(e[newK]=e[t],delete e[t])}),e}var revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams=JSON.parse(document.getElementById("reveal-hugo-site-params").innerHTML),revealHugoPageParams=JSON.parse(document.getElementById("reveal-hugo-page-params").innerHTML),options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams));Reveal.initialize(options)</script><script type=text/javascript src=/slides/reveal-js/plugin/markdown/marked.js></script>
<script type=text/javascript src=/slides/reveal-js/plugin/markdown/markdown.js></script>
<script type=text/javascript src=/slides/reveal-js/plugin/highlight/highlight.js></script>
<script type=text/javascript src=/slides/reveal-js/plugin/zoom-js/zoom.js></script>
<script type=text/javascript src=/slides/reveal-js/plugin/notes/notes.js></script></body></html>