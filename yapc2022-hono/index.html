<!doctype html><html lang=en><head><meta charset=utf-8><title>Hono[炎] Ultrafast web framework for Cloudflare Workers.</title><meta name=description content="YAPC::Japan::Online 2022"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel=canonical href=https://yusukebe.github.io/slides/yapc2022-hono/><meta property="og:title" content="Hono[炎] Ultrafast web framework for Cloudflare Workers. &ndash; yusukebe/slides"><meta property="og:description" content="YAPC::Japan::Online 2022"><meta property="og:type" content="website"><meta property="og:url" content="https://yusukebe.github.io/slides/yapc2022-hono/"><meta property="og:image" content="https://yusukebe.github.io/slides/yapc2022-hono/cover.png"><meta property="og:site_name" content="yusukebe/slides"><meta name=twitter:card content="summary_large_image"><meta name=twitter:domain content="yusukebe.github.com"><meta name=twitter:title content="Hono[炎] Ultrafast web framework for Cloudflare Workers. &ndash; yusukebe/slides"><meta name=twitter:description content="YAPC::Japan::Online 2022"><link rel=stylesheet href=/slides/reveal-js/css/reset.css><link rel=stylesheet href=/slides/reveal-js/css/reveal.css><link rel=stylesheet href=/slides/_.min.8b7d4ab64c350b0146b4922e555484af3453e7c2e0daf4e8b410d35f43bbbe2a.css id=theme><link rel=stylesheet href=/slides/highlight-js/default.min.css></head><body><div class=reveal><div class=slides><section><h1 id=hono炎-ultrafast-web-framework-for-cloudflare-workers>Hono[炎] Ultrafast web framework for Cloudflare Workers.</h1><p>Yusuke Wada</p><p>2022-03-05 YAPC::Japan::Online 2022</p></section><section><h2 id=今日話すこと>今日話すこと</h2><ol><li>Cloudflare Workers</li><li>Honoの特徴</li><li>HonoのAPI</li><li>Honoを使う</li><li>Service Worker Magic</li></ol></section><section><h1 id=はじめに>はじめに</h1></section><section><h3 id=initial-commitは25ヶ月前><code>Initial commit</code>は2.5ヶ月前</h3><p>2021-12-15</p><p><img src=ss02.png alt=SS></p></section><section><h3 id=現在のversion>現在のVersion</h3><p><code>v0.5.1</code></p></section><section><h3 id=contributors>Contributors</h3><p><img src=con.png alt=Con></p></section><section><p><img src=ss07.png alt=SS></p></section><section><p><img src=ss06.png alt=SS></p></section><section><p>作るの楽しい！！</p></section><section><h1 id=cloudflare-workersについて>Cloudflare Workersについて</h1></section><section><p>Cloudflareの<strong>CDNエッジ</strong>で実行される<strong>サーバーレス</strong>環境</p></section><section><h3 id=速い短い小さい>速い・短い・小さい</h3><ul><li>コールドスタートなし</li><li>CPU時間10ms(Free、Bundled)</li><li>1MB以内</li></ul></section><section><h3 id=cpu時間>CPU時間</h3><p>スクリプトが実行中でCPUリソースを使用している時間。</p><p><img src=ss08.png alt=SS></p></section><section><h3 id=その他のキーワード>その他のキーワード</h3><ul><li>Workers KV</li><li>Workers Durable Objects</li><li>Workers Sites</li><li>Cache API</li><li>CDNのキャッシュコントロール</li></ul></section><section><h2 id=ユースケース>ユースケース</h2></section><section><h3 id=1pcspの振り分け>1.PC/SPの振り分け</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>isMobile</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>userAgent</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>headers</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;User-Agent&#34;</span>) <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>userAgent</span>.<span style=color:#a6e22e>match</span>(<span style=color:#e6db74>/(iPhone|Android|Mobile)/</span>)) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>isMobile</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>device</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>isMobile</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#34;Mobile&#34;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;Desktop&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>cacheUrl</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>URL</span>(<span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>url</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;-&#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>device</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>cacheKey</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Request</span>(<span style=color:#a6e22e>reqeust</span>.<span style=color:#a6e22e>url</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>device</span>, <span style=color:#a6e22e>request</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>cache</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>caches</span>.<span style=color:#66d9ef>default</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>cache</span>.<span style=color:#a6e22e>match</span>(<span style=color:#a6e22e>cacheKey</span>)
</span></span></code></pre></div></section><section><h3 id=2slackスラッシュコマンド>2.Slackスラッシュコマンド</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>karma</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>, <span style=color:#a6e22e>operation</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>PREFIX</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>name</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>karm</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>KV_KARMA</span>.<span style=color:#a6e22e>get</span>(<span style=color:#a6e22e>key</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>operation</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;++&#34;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>karma</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>karma</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>karma</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>karma</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>KV_KARMA</span>.<span style=color:#a6e22e>put</span>(<span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>karma</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>name</span><span style=color:#e6db74>}</span><span style=color:#e6db74> : </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>karma</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=3ブックマークアプリ>3.ブックマークアプリ</h3><p><a href=https://github.com/yusukebe/marks>https://github.com/yusukebe/marks</a></p><p><img src=ss01.png alt=SS></p></section><section><h2 id=worker>Worker</h2></section><section><h3 id=特徴というか制限>特徴というか制限</h3><ul><li>JavaScript (Rustもサポート)</li><li>Node.jsではない</li><li>APIが限られている</li></ul></section><section><h2 id=service-workerで書く>Service Workerで書く</h2></section><section><h3 id=service-workerとは>Service Workerとは？</h3><blockquote><p>Service Worker はブラウザが Web ページとは別にバックグラウンドで実行するスクリプトで、Web ページやユーザーのインタラクションを必要としない機能を Web にもたらします。
<a href="https://developers.google.com/web/fundamentals/primers/service-workers?hl=ja">https://developers.google.com/web/fundamentals/primers/service-workers?hl=ja</a></p></blockquote></section><section><ul><li>プッシュ通知</li><li>オフラインでも閲覧できる</li><li>バックグラウンドのデータ同期</li><li>キャッシュ</li></ul></section><section><h3 id=fetchイベントを書く><code>fetch</code>イベントを書く</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handleRequest</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>request</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Response</span>(<span style=color:#e6db74>&#34;Hello YAPC!&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#34;fetch&#34;</span>, <span style=color:#a6e22e>event</span> =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>respondWith</span>(<span style=color:#a6e22e>handleRequest</span>(<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>request</span>))
</span></span><span style=display:flex><span>})
</span></span></code></pre></div></section><section><h2 id=つかえるapi>つかえるAPI</h2><ul><li>Encoding</li><li>Fetch / FetchEvent</li><li>HTMLRewriter</li><li>Headers</li><li>Request / Response</li><li>Streams</li><li>Web Crypto</li><li>Web standards</li><li>WebSockets</li><li>Cache / KV / Durable Objects</li></ul></section><section><p>Fastly Compute@Edgeでも同じコードが動くことがある</p></section><section><h2 id=wrangler>Wrangler</h2><ul><li>開発〜デプロイ</li><li><code>wrangler dev</code></li><li><code>wrangler publish</code></li></ul></section><section><h2 id=ちなみにperlで書ける>ちなみにPerlで書ける</h2></section><section><h3 id=perlito>Perlito</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>JS::inline(<span style=color:#e6db74>&#39;addEventListener(&#34;fetch&#34;, event =&gt; { p5cget(&#34;main&#34;, &#34;listener&#34;)([event]) })&#39;</span>);
</span></span></code></pre></div></section><section><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>my</span> $url <span style=color:#f92672>=</span> URL<span style=color:#f92672>-&gt;</span><span style=color:#66d9ef>new</span>($req<span style=color:#f92672>-&gt;</span>url);
</span></span><span style=display:flex><span><span style=color:#66d9ef>my</span> $query_string <span style=color:#f92672>=</span> $url<span style=color:#f92672>-&gt;</span>search;
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>my</span> $headers <span style=color:#f92672>=</span> Headers<span style=color:#f92672>-&gt;</span><span style=color:#66d9ef>new</span>();
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span> Response<span style=color:#f92672>-&gt;</span><span style=color:#66d9ef>new</span>(
</span></span><span style=display:flex><span>  $msg,
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      status  <span style=color:#f92672>=&gt;</span> <span style=color:#ae81ff>200</span>,
</span></span><span style=display:flex><span>      headers <span style=color:#f92672>=&gt;</span> $headers
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>);
</span></span></code></pre></div></section><section><p>Cloudflare Workers🔥でもPerl🐫でも動くPerlを書く</p><p><a href=https://yusukebe.com/posts/2021/psgi-cloudflare-workers/>https://yusukebe.com/posts/2021/psgi-cloudflare-workers/</a></p></section><section><h1 id=honoについて>Honoについて</h1></section><section><h2 id=1分で分かるhono>1分で分かるHono</h2><p><img src=hono.gif alt=Hono></p></section><section><h3 id=４ステップで開発デプロイ>４ステップで開発〜デプロイ</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>$ yarn init -y
</span></span><span style=display:flex><span>$ wrangler init
</span></span><span style=display:flex><span>$ touch index.js // Write code
</span></span><span style=display:flex><span>$ wrangler publish
</span></span></code></pre></div><p><code>{project-name}.{user-name}.workers.dev</code></p></section><section><h1 id=honoの特徴>Honoの特徴</h1></section><section><h3 id=モチベーション>モチベーション</h3><p>「Webサイトを作ろうとしていたら、フレームワークを作っていた」</p></section><section><p>他にも&mldr;Cloudflare向けのルーター・フレームワーク</p><ul><li>itty-router - 37行</li><li>Sunder - 先発</li><li>worktop - Cloudflareの中の人が作ってる</li></ul></section><section><h3 id=アイデンティティを探す>アイデンティティを探す</h3></section><section><h3 id=features>「Features」</h3></section><section><ul><li><strong>Ultrafast</strong></li><li>Zero dependencies</li><li>Middleware</li><li>Optimized</li><li>(TypeScript)</li></ul></section><section><h2 id=ultrafast>Ultrafast</h2></section><section><h2 id=ベンチマーク>ベンチマーク</h2></section><section><h3 id=trierouter>TrieRouter</h3></section><section><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>hono x 779,197 ops/sec ±6.55% (78 runs sampled) &lt;---
</span></span><span style=display:flex><span>itty-router x 161,813 ops/sec ±3.87% (87 runs sampled)
</span></span><span style=display:flex><span>sunder x 334,096 ops/sec ±1.33% (93 runs sampled)
</span></span><span style=display:flex><span>worktop x 212,661 ops/sec ±4.40% (81 runs sampled)
</span></span><span style=display:flex><span>Fastest is hono
</span></span></code></pre></div></section><section><h3 id=utrafast>Utrafast!</h3></section><section><h3 id=regexprouter>RegExpRouter</h3></section><section><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>hono x 723,504 ops/sec ±6.76% (63 runs sampled)
</span></span><span style=display:flex><span>hono with RegExpRouter x 934,401 ops/sec ±5.49% (68 runs sampled) &lt;---
</span></span><span style=display:flex><span>itty-router x 160,676 ops/sec ±3.23% (88 runs sampled)
</span></span><span style=display:flex><span>sunder x 312,128 ops/sec ±4.55% (85 runs sampled)
</span></span><span style=display:flex><span>worktop x 209,345 ops/sec ±4.52% (78 runs sampled)
</span></span><span style=display:flex><span>Fastest is hono with RegExpRouter
</span></span></code></pre></div></section><section><h3 id=utrafast-1>Utrafast!!!</h3></section><section><p>他の<code>node.js</code>ルーターと比べても&mldr;</p></section><section><ul><li>有名どころに圧勝</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>express benchmark (includes handling) x all together: 292,090 ops/sec
</span></span><span style=display:flex><span>koa-router benchmark x all together: 232,845 ops/sec
</span></span><span style=display:flex><span>hono RegExpRouter benchmark x all together: 1,426,009 ops/sec &lt;---
</span></span></code></pre></div></section><section><ul><li><code>find-my-way</code>に勝った => Frameworkよりだから遅い</li><li><code>trek-router</code>に負けた => RegexとMulti paramに対応しない</li><li><code>hono RegExpRouter</code> => RegexとMulti paramに対応</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>find-my-way benchmark x all together: 1,059,323 ops/sec
</span></span><span style=display:flex><span>trek-router benchmark x all together: 1,439,378 ops/sec
</span></span><span style=display:flex><span>hono RegExpRouter benchmark x all together: 1,426,009 ops/sec &lt;---
</span></span></code></pre></div></section><section><p>ほぼ最強</p></section><section><h2 id=なぜそんなに速いのか>なぜそんなに速いのか？</h2></section><section><h3 id=trierouter-1>TrieRouter</h3><p>Inspired by <strong>goblin</strong>.</p><ul><li><a href=https://github.com/bmf-san/goblin>bmf-san/goblin: A golang http router based on trie tree.</a></li><li><a href=https://bmf-tech.com/posts/Golang%E3%81%A7goblin%E3%81%A8%E3%81%84%E3%81%86URL%E3%83%AB%E3%83%BC%E3%82%BF%E3%83%BC%E3%82%92%E8%87%AA%E4%BD%9C%E3%81%97%E3%81%9F>bmf-tech - GolangでgoblinというURLルーターを自作した</a></li></ul></section><section><p>トライ木</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Node</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>T</span><span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>handler</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>T</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>children</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Record</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>string</span>, <span style=color:#a6e22e>Node</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>T</span><span style=color:#f92672>&gt;&gt;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=regexprouter-1>RegExpRouter</h3><p>Inspired by <strong>Router::Boom</strong>.</p><p><a href=https://github.com/yusukebe/hono/pull/109>Introduce RegExpRouter #109</a> by @usualoma</p></section><section><p>全てのルートをひとつの大きな正規表現にする</p><ul><li>/help</li><li>/:user_id/followees</li><li>/:user_id/followers</li><li>/:user_id/posts</li><li>/:user_id/posts/:post_id</li><li>/:user_id/posts/:post_id/likes</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>^/(?:help$()|([^/]+)/(?:followe(?:es$()|rs$())|posts(?:/([^/]+)(?:/likes$()|$())|$())))
</span></span></code></pre></div></section><section><p>だからHonoは速い</p></section><section><h2 id=その他の特徴>その他の特徴</h2></section><section><h2 id=requestresponseの扱い>Request/Responseの扱い</h2></section><section><h3 id=perlの場合>Perlの場合</h3><p>例えば<code>Plack</code>を使う</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>use</span> Plack::Request;
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>my</span> $app <span style=color:#f92672>=</span> <span style=color:#66d9ef>sub</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>my</span> $env <span style=color:#f92672>=</span> shift;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>my</span> $req <span style=color:#f92672>=</span> Plack::Request<span style=color:#f92672>-&gt;</span><span style=color:#66d9ef>new</span>($env);
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>my</span> $path_info <span style=color:#f92672>=</span> $req<span style=color:#f92672>-&gt;</span>path_info;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>my</span> $query     <span style=color:#f92672>=</span> $req<span style=color:#f92672>-&gt;</span>parameters<span style=color:#f92672>-&gt;</span>{query};
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>my</span> $res <span style=color:#f92672>=</span> $req<span style=color:#f92672>-&gt;</span>new_response(<span style=color:#ae81ff>200</span>);
</span></span><span style=display:flex><span>    $res<span style=color:#f92672>-&gt;</span>finalize;
</span></span><span style=display:flex><span>};
</span></span></code></pre></div></section><section><p>Request/Responseオブジェクトつくりがち</p></section><section><h3 id=cloudflare-workersの場合>Cloudflare Workersの場合</h3><p>そもそもRequest/Responseオブジェクトが提供されている</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>handleRequest</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>req</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Request</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>ua</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>headers</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;User-Agent&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>res</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Response</span>(<span style=color:#e6db74>`You are </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>ua</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>, {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#39;X-Message&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Hello YAPC!&#39;</span>,
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>res</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><section><h3 id=contextがショートカットを提供する>Contextがショートカットを提供する</h3><ul><li><code>c.req.header(name)</code></li><li><code>c.header(name, value)</code></li><li><code>c.json(object)</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/hello&#39;</span>, (<span style=color:#a6e22e>c</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>ua</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;User-Agent&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;X-Message&#39;</span>, <span style=color:#e6db74>&#39;Hello YAPC!&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>json</span>({ <span style=color:#e6db74>&#39;You are &#39;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>ua</span> })
</span></span><span style=display:flex><span>})
</span></span></code></pre></div></section><section><h2 id=middleware>Middleware</h2></section><section><h3 id=inspired-by-koa>Inspired by <code>koa</code></h3><blockquote><p>Everything is middleware
- &ldquo;Koa&rdquo;</p></blockquote></section><section><h3 id=middlewareを書く>Middlewareを書く</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#e6db74>&#39;*&#39;</span>, <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>c</span>, <span style=color:#a6e22e>next</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>start</span> <span style=color:#f92672>=</span> Date.<span style=color:#a6e22e>now</span>()
</span></span><span style=display:flex><span>  <span style=color:#75715e>// ^--- handle request
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>next</span>() <span style=color:#75715e>// &lt;--- dispatch handler
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// v--- handle response
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>ms</span> <span style=color:#f92672>=</span> Date.<span style=color:#a6e22e>now</span>() <span style=color:#f92672>-</span> <span style=color:#a6e22e>start</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;X-Response-Time&#39;</span>, <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>ms</span><span style=color:#e6db74>}</span><span style=color:#e6db74>ms`</span>)
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// a handler
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/hello&#39;</span>, (<span style=color:#a6e22e>c</span>) =&gt; <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>text</span>(<span style=color:#e6db74>&#39;Hello YAPC!&#39;</span>))
</span></span></code></pre></div></section><section><p>HandlerをMiddlewareが包む</p></section><section><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#e6db74>&#39;*&#39;</span>, <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>c</span>, <span style=color:#a6e22e>next</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Foo - before&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>next</span>()
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Foo - after&#39;</span>)
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#e6db74>&#39;*&#39;</span>, <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>c</span>, <span style=color:#a6e22e>next</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Bar - before&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>next</span>()
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Bar - after&#39;</span>)
</span></span><span style=display:flex><span>})
</span></span></code></pre></div></section><section><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/hello&#39;</span>, (<span style=color:#a6e22e>c</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;Handler&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>text</span>(<span style=color:#e6db74>&#39;Hello YAPC!&#39;</span>)
</span></span><span style=display:flex><span>})
</span></span></code></pre></div></section><section><p><img src=ss04.png alt=SS></p></section><section><h1 id=honoのapi>HonoのAPI</h1></section><section><h2 id=app><code>app</code></h2><ul><li>app.HTTP_METHOD(path, handler)</li><li>app.all(path, handler)</li><li>app.route(path)</li><li>app.use(path, middleware)</li><li>app.notFound(handler)</li><li>app.onError(err, handler)</li><li>app.fire()</li><li>app.fetch(request, env, event)</li></ul></section><section><h2 id=routing>Routing</h2></section><section><h3 id=apphttp_method--appall><code>app.HTTP_METHOD</code> / <code>app.all</code></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e>// HTTP Methods
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/&#39;</span>, (<span style=color:#a6e22e>c</span>) =&gt; <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>text</span>(<span style=color:#e6db74>&#39;GET /&#39;</span>))
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#39;/&#39;</span>, (<span style=color:#a6e22e>c</span>) =&gt; <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>text</span>(<span style=color:#e6db74>&#39;POST /&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Wildcard
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/wild/*/card&#39;</span>, (<span style=color:#a6e22e>c</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>text</span>(<span style=color:#e6db74>&#39;GET /wild/*/card&#39;</span>)
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Any HTTP methods
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>all</span>(<span style=color:#e6db74>&#39;/hello&#39;</span>, (<span style=color:#a6e22e>c</span>) =&gt; <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>text</span>(<span style=color:#e6db74>&#39;Any Method /hello&#39;</span>))
</span></span></code></pre></div></section><section><h3 id=named-parameter>Named Parameter</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/user/:name&#39;</span>, (<span style=color:#a6e22e>c</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>param</span>(<span style=color:#e6db74>&#39;name&#39;</span>)
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>})
</span></span></code></pre></div></section><section><p><img src=named.png alt=Named></p><p><a href=https://github.com/yusukebe/hono/pull/102>Added type to c.req.param key. #102</a> by @usualoma</p></section><section><h3 id=regexp>Regexp</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/post/:date{[0-9]+}/:title{[a-z]+}&#39;</span>, (<span style=color:#a6e22e>c</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>date</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>param</span>(<span style=color:#e6db74>&#39;date&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>title</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>param</span>(<span style=color:#e6db74>&#39;title&#39;</span>)
</span></span><span style=display:flex><span>  ...
</span></span></code></pre></div></section><section><h3 id=nested-route>Nested route</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>book</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>route</span>(<span style=color:#e6db74>&#39;/book&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>book</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/&#39;</span>, (<span style=color:#a6e22e>c</span>) =&gt; <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>text</span>(<span style=color:#e6db74>&#39;List Books&#39;</span>)) <span style=color:#75715e>// =&gt; GET /book
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>book</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/:id&#39;</span>, (<span style=color:#a6e22e>c</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// =&gt; GET /book/:id
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>id</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>param</span>(<span style=color:#e6db74>&#39;id&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>text</span>(<span style=color:#e6db74>&#39;Get Book: &#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>id</span>)
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#a6e22e>book</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#39;/&#39;</span>, (<span style=color:#a6e22e>c</span>) =&gt; <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>text</span>(<span style=color:#e6db74>&#39;Create Book&#39;</span>)) <span style=color:#75715e>// =&gt; POST /book
</span></span></span></code></pre></div></section><section><h3 id=no-strict>no strict</h3><p>If <code>strict</code> is set <code>false</code>, <code>/hello</code>and<code>/hello/</code> are treated the same:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>app</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Hono</span>({ <span style=color:#a6e22e>strict</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span> })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/hello&#39;</span>, (<span style=color:#a6e22e>c</span>) =&gt; <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>text</span>(<span style=color:#e6db74>&#39;/hello or /hello/&#39;</span>))
</span></span></code></pre></div></section><section><h2 id=asyncawait>async/await</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/fetch-url&#39;</span>, <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>c</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#39;https://example.com/&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>text</span>(<span style=color:#e6db74>`Status is </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>status</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>)
</span></span><span style=display:flex><span>})
</span></span></code></pre></div></section><section><h2 id=middleware-1>Middleware</h2></section><section><h3 id=builtin-middleware>Builtin Middleware</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Hono</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;hono&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>poweredBy</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;hono/powered-by&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>logger</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;hono/logger&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>basicAuth</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;hono/basicAuth&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>app</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Hono</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#e6db74>&#39;*&#39;</span>, <span style=color:#a6e22e>poweredBy</span>())
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#e6db74>&#39;*&#39;</span>, <span style=color:#a6e22e>logger</span>())
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#e6db74>&#39;/auth/*&#39;</span>, <span style=color:#a6e22e>basicAuth</span>({ <span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;hono&#39;</span>, <span style=color:#a6e22e>password</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;acoolproject&#39;</span> }))
</span></span></code></pre></div></section><section><h3 id=available-builtin-middleware>Available builtin middleware</h3><ul><li>basic-auth &lt;&mdash; 1から作るとダルい</li><li>body-parse</li><li>cookie</li><li>cors</li><li>etag</li><li>logger</li><li>mustache &lt;&mdash; テンプレート</li><li>powered-by</li><li>serve-static &lt;&mdash; KVを使う</li></ul></section><section><h3 id=custom-middleware>Custom Middleware</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e>// Custom logger
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#e6db74>&#39;*&#39;</span>, <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>c</span>, <span style=color:#a6e22e>next</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`[</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>method</span><span style=color:#e6db74>}</span><span style=color:#e6db74>] </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>url</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>next</span>()
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Add a custom header
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#e6db74>&#39;/message/*&#39;</span>, <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>c</span>, <span style=color:#a6e22e>next</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>next</span>()
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;x-message&#39;</span>, <span style=color:#e6db74>&#39;This is middleware!&#39;</span>)
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/message/hello&#39;</span>, (<span style=color:#a6e22e>c</span>) =&gt; <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>text</span>(<span style=color:#e6db74>&#39;Hello Middleware!&#39;</span>))
</span></span></code></pre></div></section><section><h2 id=not-found>Not Found</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>notFound</span>((<span style=color:#a6e22e>c</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>text</span>(<span style=color:#e6db74>&#39;Custom 404 Message&#39;</span>, <span style=color:#ae81ff>404</span>)
</span></span><span style=display:flex><span>})
</span></span></code></pre></div></section><section><h2 id=error-handling>Error Handling</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>onError</span>((<span style=color:#a6e22e>err</span>, <span style=color:#a6e22e>c</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>err</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>text</span>(<span style=color:#e6db74>&#39;Custom Error Message&#39;</span>, <span style=color:#ae81ff>500</span>)
</span></span><span style=display:flex><span>})
</span></span></code></pre></div></section><section><h2 id=context>Context</h2></section><section><h3 id=creq>c.req</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/shortcut&#39;</span>, (<span style=color:#a6e22e>c</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>userAgent</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;User-Agent&#39;</span>)
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/search&#39;</span>, (<span style=color:#a6e22e>c</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>query</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>query</span>(<span style=color:#e6db74>&#39;q&#39;</span>)
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/entry/:id&#39;</span>, (<span style=color:#a6e22e>c</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>id</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>param</span>(<span style=color:#e6db74>&#39;id&#39;</span>)
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>})
</span></span></code></pre></div></section><section><h3 id=shortcuts-for-response>Shortcuts for Response</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/welcome&#39;</span>, (<span style=color:#a6e22e>c</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;X-Message&#39;</span>, <span style=color:#e6db74>&#39;Hello!&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;Content-Type&#39;</span>, <span style=color:#e6db74>&#39;text/plain&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>status</span>(<span style=color:#ae81ff>201</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>body</span>(<span style=color:#e6db74>&#39;Thank you for comming&#39;</span>)
</span></span><span style=display:flex><span>})
</span></span></code></pre></div></section><section><p>以下と同じ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Response</span>(<span style=color:#e6db74>&#39;Thank you for comming&#39;</span>, {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>status</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>201</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>statusText</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Created&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>   <span style=color:#e6db74>&#39;X-Message&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Hello&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;Content-Type&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;text/plain&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;Content-Length&#39;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;22&#39;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>})
</span></span></code></pre></div></section><section><h3 id=ctext>c.text()</h3><p>Render text as <code>Content-Type:text/plain</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/say&#39;</span>, (<span style=color:#a6e22e>c</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>text</span>(<span style=color:#e6db74>&#39;Hello!&#39;</span>)
</span></span><span style=display:flex><span>})
</span></span></code></pre></div></section><section><h3 id=cjson>c.json()</h3><p>Render JSON as <code>Content-Type:application/json</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/api&#39;</span>, (<span style=color:#a6e22e>c</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>json</span>({ <span style=color:#a6e22e>message</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Hello!&#39;</span> })
</span></span><span style=display:flex><span>})
</span></span></code></pre></div></section><section><h3 id=chtml>c.html()</h3><p>Render HTML as <code>Content-Type:text/html</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/&#39;</span>, (<span style=color:#a6e22e>c</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>html</span>(<span style=color:#e6db74>&#39;&lt;h1&gt;Hello! Hono!&lt;/h1&gt;&#39;</span>)
</span></span><span style=display:flex><span>})
</span></span></code></pre></div></section><section><h3 id=credirect>c.redirect()</h3><p>Redirect, default status code is <code>302</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/redirect&#39;</span>, (<span style=color:#a6e22e>c</span>) =&gt; <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>redirect</span>(<span style=color:#e6db74>&#39;/&#39;</span>))
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/redirect-permanently&#39;</span>, (<span style=color:#a6e22e>c</span>) =&gt; <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>redirect</span>(<span style=color:#e6db74>&#39;/&#39;</span>, <span style=color:#ae81ff>301</span>))
</span></span></code></pre></div></section><section><h3 id=cres>c.res</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e>// Response object
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#e6db74>&#39;/&#39;</span>, (<span style=color:#a6e22e>c</span>, <span style=color:#a6e22e>next</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>next</span>()
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>headers</span>.<span style=color:#a6e22e>append</span>(<span style=color:#e6db74>&#39;X-Debug&#39;</span>, <span style=color:#e6db74>&#39;Debug message&#39;</span>)
</span></span><span style=display:flex><span>})
</span></span></code></pre></div></section><section><h3 id=cevent>c.event</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e>// FetchEvent object
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#e6db74>&#39;*&#39;</span>, <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>c</span>, <span style=color:#a6e22e>next</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>waitUntil</span>(
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>next</span>()
</span></span><span style=display:flex><span>})
</span></span></code></pre></div></section><section><h3 id=cenv>c.env</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#75715e>// Environment object for Cloudflare Workers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;*&#39;</span>, <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>c</span> =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>counter</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>COUNTER</span>
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>})
</span></span></code></pre></div></section><section><h2 id=fire>fire</h2><p><code>app.fire()</code> do:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#39;fetch&#39;</span>, (<span style=color:#a6e22e>event</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>respondWith</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>handleEvent</span>(<span style=color:#a6e22e>event</span>))
</span></span><span style=display:flex><span>})
</span></span></code></pre></div></section><section><h2 id=fetch>fetch</h2><p><code>app.fetch()</code> is for Cloudflare Module Worker syntax.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fetch</span>(<span style=color:#a6e22e>request</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Request</span>, <span style=color:#a6e22e>env</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>Env</span>, <span style=color:#a6e22e>event</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>FetchEvent</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>fetch</span>(<span style=color:#a6e22e>request</span>, <span style=color:#a6e22e>env</span>, <span style=color:#a6e22e>event</span>)
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>or just do this:
</span></span></span><span style=display:flex><span><span style=color:#75715e>export default app
</span></span></span><span style=display:flex><span><span style=color:#75715e>*/</span>
</span></span></code></pre></div></section><section><h1 id=use-hono><code>use Hono</code></h1></section><section><h3 id=hono-starter>Hono Starter</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>wrangler generate my-app https://github.com/yusukebe/hono-minimal
</span></span></code></pre></div></section><section><p><img src=ss03.png alt=SS></p></section><section><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>.
</span></span><span style=display:flex><span>├── README.md
</span></span><span style=display:flex><span>├── package.json
</span></span><span style=display:flex><span>├── src
</span></span><span style=display:flex><span>│   └── index.ts
</span></span><span style=display:flex><span>└── wrangler.toml
</span></span></code></pre></div></section><section><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span>  <span style=color:#e6db74>&#34;dependencies&#34;</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;hono&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;^0.5.1&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;devDependencies&#34;</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;esbuild&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;^0.14.23&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;miniflare&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;2.2.0&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span></code></pre></div></section><section><h3 id=hono-examples>Hono Examples</h3><ul><li>basic</li><li>blog</li><li>compute-at-edge</li><li>durable-objects</li><li>jsx-ssr</li><li>serve-static</li></ul></section><section><p>Not only for Web API</p></section><section><p>「家系ラーメン食べたい！」</p></section><section><p><img src=ie01.png alt=ie></p></section><section><p><img src=ie02.png alt=ie></p></section><section><h3 id=家系ラーメン食べたい>家系ラーメン食べたい！</h3><p><code>mustache</code>ブランチ</p><ul><li>Hono</li><li><code>serve-static Middleware</code></li><li><code>mustache Middleware</code></li><li>開発・デプロイにWrangler 2.0</li></ul></section><section><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Hono</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;hono&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>mustache</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;hono/mustache&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>serveStatic</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;hono/serve-static&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>ies</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;./ies&#39;</span>
</span></span></code></pre></div></section><section><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#e6db74>&#39;*&#39;</span>, <span style=color:#a6e22e>mustache</span>({ <span style=color:#a6e22e>root</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;view&#39;</span> }))
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#e6db74>&#39;/static/*&#39;</span>, <span style=color:#a6e22e>serveStatic</span>({ <span style=color:#a6e22e>root</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;public&#39;</span> }))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>use</span>(<span style=color:#e6db74>&#39;/static/*&#39;</span>, <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>c</span>, <span style=color:#a6e22e>next</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>next</span>()
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>headers</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;Content-Type&#39;</span>).<span style=color:#a6e22e>match</span>(<span style=color:#e6db74>/image/</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;Cache-Control&#39;</span>, <span style=color:#e6db74>&#39;public, max-age=86400&#39;</span>)
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>})
</span></span></code></pre></div></section><section><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>partials</span> <span style=color:#f92672>=</span> { <span style=color:#a6e22e>header</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;header&#39;</span>, <span style=color:#a6e22e>footer</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;footer&#39;</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/&#39;</span>, (<span style=color:#a6e22e>c</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>render</span>(<span style=color:#e6db74>&#39;index&#39;</span>, { <span style=color:#a6e22e>ies</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>ies</span> }, <span style=color:#a6e22e>partials</span>)
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;/ie/:name&#39;</span>, (<span style=color:#a6e22e>c</span>) =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>param</span>(<span style=color:#e6db74>&#39;name&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>ie</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ies</span>.<span style=color:#a6e22e>find</span>((<span style=color:#a6e22e>i</span>) =&gt; <span style=color:#a6e22e>i</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>name</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>ie</span>) <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>notFound</span>()
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>render</span>(<span style=color:#e6db74>&#39;ie&#39;</span>, <span style=color:#a6e22e>ie</span>, <span style=color:#a6e22e>partials</span>)
</span></span><span style=display:flex><span>})
</span></span></code></pre></div></section><section><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=nohighlight data-noescape><span style=display:flex><span><span style=color:#a6e22e>app</span>.<span style=color:#a6e22e>fire</span>()
</span></span></code></pre></div></section><section><h3 id=家系ラーメン食べたい-1>家系ラーメン食べたい！</h3><p><code>react</code>ブランチ</p><ul><li>Honoを使っている</li><li>ReactSSRしている（クライアントは何もしてない）</li><li>microCMSでコンテンツを管理</li><li>APIレスポンスはKVでキャッシュ</li><li>Webhookを受け取って、キャッシュをパージ</li><li>開発にmifnilare 2.x、デプロイにはWrangler 2.0</li></ul></section><section><p>CDNエッジでも「ちゃんとした」Webがつくれる</p></section><section><p><a href=https://iekei.yusukebe.workers.dev/>https://iekei.yusukebe.workers.dev/</a></p></section><section><h1 id=service-worker-magic>Service Worker Magic</h1></section><section><ul><li>Server (Cloudflare Workers) code is <code>sw.js</code>.</li><li>Browser ( Service Worker ) code is <code>sw.js</code>.</li><li>Cloudflare Workers <code>sw.js</code> serves <code>sw.js</code>.</li><li>Service Worker <code>sw.js</code> is registered on <code>/</code>.</li><li>The scope is <code>/sw/*</code>.</li><li><code>/server/hello</code> => from the server.</li><li><code>/sw/hello</code> => from the browser.</li><li>Request is intercepted by Service Worker.</li></ul></section><section><p><img src=magic.gif alt=Magic></p></section><section><p><a href=https://service-worker-magic.yusukebe.workers.dev>https://service-worker-magic.yusukebe.workers.dev</a></p></section><section><h2 id=enjoy-hono>Enjoy Hono!</h2><p><a href=https://github.com/yusukebe/hono>https://github.com/yusukebe/hono</a></p></section><section><p>おしまい</p></section></div></div><script type=text/javascript src=/slides/reveal-hugo/object-assign.js></script>
<a href=/slides/reveal-js/css/print/ id=print-location style=display:none></a>
<script type=text/javascript>var printLocationElement=document.getElementById("print-location"),link=document.createElement("link");link.rel="stylesheet",link.type="text/css",link.href=printLocationElement.href+(window.location.search.match(/print-pdf/gi)?"pdf.css":"paper.css"),document.getElementsByTagName("head")[0].appendChild(link)</script><script type=application/json id=reveal-hugo-site-params>{"custom_theme":"stylesheets/custom-theme.scss","custom_theme_compile":true}</script><script type=application/json id=reveal-hugo-page-params>null</script><script src=/slides/reveal-js/js/reveal.js></script>
<script type=text/javascript>function camelize(e){return e&&Object.keys(e).forEach(function(t){newK=t.replace(/(_\w)/g,function(e){return e[1].toUpperCase()}),newK!=t&&(e[newK]=e[t],delete e[t])}),e}var revealHugoDefaults={center:!0,controls:!0,history:!0,progress:!0,transition:"slide"},revealHugoSiteParams=JSON.parse(document.getElementById("reveal-hugo-site-params").innerHTML),revealHugoPageParams=JSON.parse(document.getElementById("reveal-hugo-page-params").innerHTML),options=Object.assign({},camelize(revealHugoDefaults),camelize(revealHugoSiteParams),camelize(revealHugoPageParams));Reveal.initialize(options)</script><script type=text/javascript src=/slides/reveal-js/plugin/markdown/marked.js></script>
<script type=text/javascript src=/slides/reveal-js/plugin/markdown/markdown.js></script>
<script type=text/javascript src=/slides/reveal-js/plugin/highlight/highlight.js></script>
<script type=text/javascript src=/slides/reveal-js/plugin/zoom-js/zoom.js></script>
<script type=text/javascript src=/slides/reveal-js/plugin/notes/notes.js></script></body></html>